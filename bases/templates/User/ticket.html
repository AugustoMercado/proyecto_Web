{% extends 'index.html' %}
{% load static %}

{% block content %}

<style>
    .ticket-container {
        display: flex; justify-content: center; align-items: center;
        min-height: 80vh; background-color: #2c3e50; padding: 20px;
    }
    .ticket-paper {
        background: #fff; width: 350px; padding: 30px 20px;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
        font-family: 'Courier New', Courier, monospace; 
        text-align: center;
        position: relative;
    }
    .ticket-paper::before, .ticket-paper::after {
        content: ""; position: absolute; width: 100%; height: 10px; left: 0;
        background: linear-gradient(135deg, transparent 5px, #fff 5px) left,
                    linear-gradient(45deg, transparent 5px, #fff 5px) left;
        background-size: 20px 20px;
        background-repeat: repeat-x;
    }
    .ticket-paper::before { top: -10px; transform: rotate(180deg); }
    .ticket-paper::after { bottom: -10px; }

    .shop-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
    .divider { border-top: 2px dashed #333; margin: 15px 0; }
    .item-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; text-align: left; }
    .total-row { display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; margin-top: 15px; }
    
    .qr-img { width: 200px; height: 200px; margin: 20px auto; display: block; }
    
</style>

<div class="ticket-container">
    <div class="ticket-paper">
        
        <div class="shop-title">ALMACEN BELLA</div>
        <p>Comprobante de Retiro</p>
        <p>{{ date|date:"d/m/Y H:i" }}</p>

        <div class="divider"></div>

        {% for item in cart.cartbuy.all %}
        <div class="item-row">
            <span>{{ item.quantity }} x {{ item.product.name|truncatechars:15 }}</span>
            <span>${{ item.subtotal|floatformat:0 }}</span>
        </div>
        {% endfor %}

        <div class="divider"></div>

        <div class="total-row">
            <span>TOTAL:</span>
            <span>${{ cart.get_total|floatformat:0 }}</span>
        </div>

        <div class="divider"></div>

        <h3>ESCANEAR EN CAJA</h3>
        <img src="data:image/png;base64,{{ qr_code }}" class="qr-img" alt="Código QR">
        
        <p style="font-size: 0.8rem;">Presenta este código al vendedor para retirar tu pedido.</p>

        <br><br>
        <a href="{% url 'main' %}" style="text-decoration: none; color: #333; font-weight: bold;">← Volver al Inicio</a>

    </div>
</div>

{% endblock %}